<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UTC | Admin</title>

    <!-- style.css  -->
    <link rel="stylesheet" href="style.css">
    <!-- boxicons -->
    <link href='https://unpkg.com/boxicons@2.1.2/css/boxicons.min.css' rel='stylesheet'>


</head>

<body>
    <!-- navbar -->

    <div class="container">
        <div class="navigation">
            <div class="main-utc">
                <div class="utc">
                    <a href="">
                        <span class="icon"><ion-icon name="school-outline"></ion-icon></span>
                        <span class="title">U-ThinkCrazy</span>
                    </a>
                    <hr>
                </div>
            </div>

            <ul>

                <li>
                    <a href="dashboard.html">
                        <span class="icon"><ion-icon name="home-outline"></ion-icon></span>
                        <span class="title">Dashboard</span>
                    </a>
                </li>

                <li id="addAdmin">
                    <a href="add-admin.html">
                        <span class="icon"><ion-icon name="person-add-outline"></ion-icon></span>
                        <span class="title">Add Admin</span>
                    </a>
                </li>

                <li id="adminUser">
                    <a href="admin-user.html">
                        <span class="icon"><ion-icon name="people-outline"></ion-icon></span>
                        <span class="title">Admin User</span>
                    </a>
                </li>

                <li id="utcUsers">
                    <a href="utc-user.html">
                        <span class="icon"><ion-icon name="man-outline"></ion-icon></span>
                        <span class="title">UTC User</span>
                    </a>
                </li>

                <li>
                    <a href="course.html">
                        <span class="icon"><ion-icon name="book-outline"></ion-icon></span>
                        <span class="title">Courses</span>
                    </a>
                </li>

                <li>
                    <a href="subject.html">
                        <span class="icon"><ion-icon name="albums-outline"></ion-icon></span>
                        <span class="title">Subject</span>
                    </a>
                </li>


                <li>
                    <a href="unit.html">
                        <span class="icon"><ion-icon name="document-outline"></ion-icon></span>
                        <span class="title">Unit</span>
                    </a>
                </li>

                <li>
                    <a href="chapter.html">
                        <span class="icon"><ion-icon name="layers-outline"></ion-icon></span>
                        <span class="title">Chapter</span>
                    </a>
                </li>

                <li>
                    <a href="add-question.html">
                        <span class="icon"><ion-icon name="add-circle-outline"></ion-icon></span>
                        <span class="title">Add Questions</span>
                    </a>
                </li>
                <li>
                    <a href="mcq.html">
                        <span class="icon"><ion-icon name="document-outline"></ion-icon></span>
                        <span class="title"> Mcq</span>
                    </a>
                </li>

                <li>
                    <a href="add-test-mcq.html">
                        <span class="icon"><ion-icon name="document-outline"></ion-icon></span>
                        <span class="title">Add Test Mcq</span>
                    </a>
                </li>

                <li id="signOut">
                    <a  >
                        <span class="icon"><ion-icon name="log-out-outline"></ion-icon></span>
                        <span class="title">Sign Out</span>
                    </a>
                </li>

                <li>
                    <hr>
                    <a href="#">
                        <span class="company">@Designed By: PR Software</span>
                    </a>
                </li>

            </ul>
        </div>
    </div>

    <div class="main">
        <div class="topbar">
            <div class="toggle"><ion-icon name="menu-outline"></ion-icon></div>
            <div class="header-section">
                <h2 class="header-title">Courses/Subjects/Units/Chapters</h2>
            </div>

            <a href="#add" class="a" style="text-decoration: none;"><button class="btnopen" id="menu-btn"><ion-icon
                        name="add-outline"></ion-icon>Add Chapter</button></a>
        </div>

        <div class="bodycontainer">

            <div class="user-container">
                <!-- <div class="user-info-heading"> -->
                <section class="box hide" id="add">
                    <a href="#">
                        <div class="close">&times;</div>
                    </a>
                    <div class="circle">
                        <span class="qhead"></span>
                        <span class="qbody"></span>
                    </div>
                    <div class="q-box">
                        <div>
                            <select class="select" id="courseSelect">
                                <option>Select course</option>


                            </select>
                            <select class="select" id="subjectSelect">
                                <option>Select Subject</option>


                            </select>
                            <select class="select" id="unitSelect">
                                <option>Select Units</option>


                            </select>
                            <br>
                            <input type="text" class="content" id="chapterName" required="required"><br>
                            <label for="Name" class="label">Chapter Name</label>

                            <button type="button" class="button" id="insertChapter">Add Chapter</button>
                        </div>
                    </div>
                </section>


                <table class="spacing" id="chapterTable">
                    <thead>
                        <tr class="movies-info-heading">
                            <div class="movies-heading-container">
                                <th>ID</th>
                                <th>Courses</th>
                                <th>Subjects</th>
                                <th>Units</th>
                                <th>Chapters</th>

                                <th style="text-align: right;">ACTIONS</th>
                            </div>
                        </tr>

                    </thead>
                    <tbody>
                        

                    </tbody>


                    

                </table>
            </div>

        </div>
    </div>

    <script>

        if (sessionStorage.getItem("isLogin") == "true") {
            sessionStorage.setItem("alreadyLogin", "true");
            console.log(sessionStorage.getItem("alreadyLogin"));
            
        }
        else {
            // Replace 'https://example.com/new-page' with the URL you want to navigate to.
            window.location.href = 'index.html';

        }

        if (sessionStorage.getItem("role") == "Editor") {
            var addAdmin = document.getElementById("addAdmin");
            var adminUser = document.getElementById("adminUser");
            var utcUsers = document.getElementById("utcUsers");

            addAdmin.style.display = "none";
            adminUser.style.display = "none";
            utcUsers.style.display = "none";
            
        } else {
            
        }

        document.getElementById("signOut").onclick = function () {
            sessionStorage.removeItem("role");
            sessionStorage.removeItem("isLogin");
            sessionStorage.removeItem("alreadyLogin");
            window.location.href = 'index.html';
        }
    </script>

    <script type="text/javascript">
        const currentLocation = location.href;
        const menuItem = document.querySelectorAll('a');
        const menuLength = menuItem.length
        for (let i = 0; i < menuLength; i++) {
            if (menuItem[i].href === currentLocation) {
                menuItem[i].className = "active"
            }
        }
    </script>

    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-analytics.js";
        import { getFirestore, setDoc, collection, addDoc, getDocs, query, where,deleteDoc,doc } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-firestore.js";
        // import { doc, setDoc } from "firebase/firestore";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries

        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
            apiKey: "AIzaSyAykzLbpWz0eu1aZY-InIJmFAlGPG-Uduo",
            authDomain: "uthinkcrazy-def5b.firebaseapp.com",
            databaseURL: "https://uthinkcrazy-def5b-default-rtdb.firebaseio.com",
            projectId: "uthinkcrazy-def5b",
            storageBucket: "uthinkcrazy-def5b.appspot.com",
            messagingSenderId: "1003988614348",
            appId: "1:1003988614348:web:f3dae19a539487cbbf9669",
            measurementId: "G-MB9FCXW264"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const db = getFirestore(app);


        var courseID = "";
        var subjectID = "";
        var unitId = "";
        var q;



        document.getElementById("courseSelect").onclick = function () {

            var x = document.getElementById("courseSelect");
            var value = x.options[x.selectedIndex].text;
            courseID = value;


            const subjectSelect = document.querySelector("#subjectSelect");
            q = query(collection(db, "subject"), where("cid", "==", courseID != "" ? courseID : "IOE"));


            subjectSelect.innerHTML = "";
            const row3 = document.createElement("option");
            row3.innerHTML = `
            <option value="">Select Subject</option>
                
            `;
            subjectSelect.appendChild(row3);

            var querySnapshot = getDocs(q).then(
                querySnapshot => {
                    querySnapshot.forEach((doc) => {
                        // doc.data() is never undefined for query doc snapshots
                        const data2 = doc.data();
                        const row2 = document.createElement("option");


                        row2.innerHTML = `
            
        
            <option value="${data2.subjectName}">${data2.subjectName}</option>
                
            `;
                        subjectSelect.appendChild(row2);

                        console.log(doc.id, " => ", doc.data());
                    });
                }
            );


        }


        document.getElementById("subjectSelect").onclick = function () {
            var y = document.getElementById("subjectSelect");
            var value2 = y.options[y.selectedIndex].text;
            subjectID = value2;

            const subjectSelect = document.querySelector("#unitSelect");
            q = query(collection(db, "unit"), where("sid", "==", subjectID != "" ? subjectID : ""),where("cid", "==", courseID != "" ? courseID : ""));


            subjectSelect.innerHTML = "";
            const row3 = document.createElement("option");
            row3.innerHTML = `
            <option value="">Select Unit</option>
                
            `;
            subjectSelect.appendChild(row3);

            var querySnapshot = getDocs(q).then(
                querySnapshot => {
                    querySnapshot.forEach((doc) => {
                        // doc.data() is never undefined for query doc snapshots
                        const data2 = doc.data();
                        const row2 = document.createElement("option");


                        row2.innerHTML = `
            
        
            <option value="${data2.unittName}">${data2.unitName}</option>
                
            `;
                        subjectSelect.appendChild(row2);

                        console.log(doc.id, " => ", doc.data());
                    });
                }
            );


        }

        document.getElementById("unitSelect").onclick = function () {
            var y = document.getElementById("unitSelect");
            var value2 = y.options[y.selectedIndex].text;
            unitId = value2;
        }




        // add course name to the selector
        const courseSelect = document.querySelector("#courseSelect");

        const querySnapshot1 = await getDocs(collection(db, "course"));
        querySnapshot1.forEach((doc) => {
            // doc.data() is never undefined for query doc snapshots

            const data = doc.data();
            const row1 = document.createElement("option");

            row1.innerHTML = `
            
                
    <option value="${data.courseName}">${data.courseName}</option>
                
            `;
            courseSelect.appendChild(row1);

            // console.log(doc.id, " => ", doc.data());

        });


        var chapterName;
        var courseDeleteId;
        var documentId;


        function readFom() {
            chapterName = document.getElementById("chapterName").value;

            console.log(courseID);
            console.log(subjectID);
            console.log(unitId);

        }

        document.getElementById("insertChapter").onclick = function () {
            readFom();
            if (chapterName == "" || courseID == "" || subjectID == "" || unitId == "") {
                alert("All Fields Required");
            } else {

            // Add a new document in collection "cities"
            addDoc(collection(db, "chapter",), {
                chapterName: chapterName,
                chapterId: chapterName,
                unitId: unitId,
                sid: subjectID,
                cid: courseID,
            });
            alert("Data Inserted");
            document.getElementById("chapterName").value = "";
            }

        };




        // // add item to the table

        const tableBody = document.querySelector("#chapterTable tbody");

        const querySnapshot2 = await getDocs(collection(db, "chapter"));

        var id = 0;
        querySnapshot2.forEach((docs) => {
            // doc.data() is never undefined for query doc snapshots
            console.log(docs.id, " => ", docs.data());
            const data1 = docs.data();
            id++;
            const row2 = document.createElement("tr");
            row2.className = "movies-info-heading-data";
            row2.innerHTML = `
            <tr>
                
                    <td>
                        <p class="id-data" style="color: white;">${id}</p>
                    </td>
                    <td>
                        <div class="info-container">
                            <p class="id-data" style="color: white;">${data1.cid}</p>
                        </div>
                    </td>
                    <td style=" letter-spacing: 1px">
                        <p class="comment-data" style="color: white;">${data1.sid}</p>
                    </td>
                    <td>
                        <p class="review-data" style="color: white;">${data1.unitId}</p>
                    </td>
                    <td>
                        <p class="status-data" style="color: white;">${data1.chapterName}</p>
                    </td>
                    <td style="text-align: right;">
                        <div class="action-container">
                           
                            <a href="${doc.id}" id="${id}"><i class='bx bxs-trash delete-icon'></i></a>
                        </div>
                    </td>
                
            </tr>`;
            tableBody.appendChild(row2);
            var anchor = document.getElementById(id);
                        
                        anchor.href = docs.id;

                         // Attach a click event listener to each anchor tag
                        anchor.addEventListener("click", function(event) {
                        event.preventDefault(); // Prevent the default behavior of anchor tags
                        courseDeleteId = data1.chapterId;
                        documentId = docs.id;
                        deleteCourse(courseDeleteId);
                        console.log("Clicked href:", courseDeleteId);
                        // You can now use `clickedHref` as needed
                        });

        });

        function deleteCourse(id){






var t = query(collection(db, "chapter"), where("chapterId", "==", id));

var querySnapshot = getDocs(t).then(
    querySnapshot => {
        querySnapshot.forEach((docs) => {
            deleteDoc(doc(db, "chapter", docs.id));
        });
    }
);

alert("Chapters Deleted..!");

}


    </script>

    <!-- <script src="myscript.js"></script> -->
    <script src='https://cdn.firebase.com/js/client/2.2.1/firebase.js'></script>
    <script src='https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js'></script>

    <script src="main.js"></script>
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>

</body>

</html>